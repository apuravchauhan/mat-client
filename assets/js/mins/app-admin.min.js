var MatrimonialApp=angular.module("MATRIMONIAL-APP",["ngRoute"]);var atrDef={cat:{name:"Category",vals:[{c:"bride",n:"Bride"},{c:"groom",n:"Groom"}]},stat:{name:"Status",vals:[{c:"un",n:"Unmarried"},{c:"wid",n:"Widowed"},{c:"div",n:"Divorced"},{c:"wtDiv",n:"Awaiting Divorce"}]},edu:{name:"Education field",vals:[{c:"edE",n:"Engineering/ Technology"},{c:"edCI",n:"Computers/ IT"},{c:"edED",n:"Education"},{c:"edM",n:"Medical/ Healthcare"},{c:"edS",n:"Science"},{c:"edF",n:"Finance/ Banking"},{c:"edC",n:"Commerce"},{c:"edA",n:"Arts"},{c:"edL",n:"Law"},{c:"edH",n:"Hotel/ Hospitality"},{c:"edMJ",n:"Media/ Journalism"},{c:"edD",n:"Architecture/ Design"},{c:"edT",n:"Travel/ Tourism"},{c:"edO",n:"Others"}]},workStat:{name:"Work area",vals:[{c:"wNW",n:"Not working"},{c:"wIT",n:"IT/ Software Engineering"},{c:"wEN",n:"Engineering/ Non IT"},{c:"wTT",n:"Teaching/ Training"},{c:"wMD",n:"Medical/ Doctor/ Surgeon"},{c:"wNH",n:"Nursing/ Healthcare"},{c:"wFB",n:"Finance/ Banking/ Accounting"},{c:"wHH",n:"Hotel/ Hospitality"},{c:"wAH",n:"Admin/ HR"},{c:"wMJ",n:"Media/ Journalism/ Entertainment"},{c:"wAG",n:"Agriculture"},{c:"wAV",n:"Airline/ Aviation"},{c:"wAD",n:"Architecture/ Design"},{c:"wWD",n:"Art/ Web Design/ Animation"},{c:"wFJ",n:"Fashion/ Beauty/ Jewellery"},{c:"wBP",n:"BPO/ Customer Support/ KPO"},{c:"wCS",n:"Civil Services"},{c:"wD",n:"Defense"},{c:"wL",n:"Legal/ Law"},{c:"wM",n:"Music"},{c:"wMN",n:"Merchant Navy"},{c:"wSM",n:"Sales/ Marketing"},{c:"wS",n:"Science"},{c:"wCT",n:"Contracting/ Trading"},{c:"wSW",n:"Social Work/ NGO"},{c:"wSP",n:"Sports"},{c:"wTR",n:"Travel/ Tourism"},{c:"wW",n:"Writer/ Literature"},{c:"wOT",n:"Others"}]},inc:{name:"Annual Income",vals:[{c:0,n:"Not applicable"},{c:1,n:"Upto INR 2 Lakhs"},{c:2,n:"INR 2 Lakhs to 4 Lakhs"},{c:4,n:"INR 4 Lakhs to 7 Lakhs"},{c:7,n:"INR 7 Lakhs to 10 Lakhs"},{c:10,n:"INR 10 Lakhs to 15 Lakhs"},{c:15,n:"INR 15 Lakhs to 20 Lakhs"},{c:20,n:"INR 20 Lakhs to 30 Lakhs"},{c:30,n:"INR 30 Lakhs to 50 Lakhs"},{c:50,n:"INR 50 Lakhs to 75 Lakhs"},{c:75,n:"INR 75 Lakhs to 1 Crore"},{c:100,n:"INR 1 Crore & above"}]}};var contactEmail="contact@matrified.com";var appMessages={"info.mail_alreadyexists":"Account with same email already exists."};MatrimonialApp.factory("MatrimonyUtils",["ageheightFilter","$timeout","$rootScope",function(e,c,a){var f=[];var d=[];var b={convertAge:function(g){var h=new Date();var i=h.getTime()-g;return Math.floor(i/(1000*60*60*24*365.25))},getHeights:function(){if(d.length>0){return d}var g=152;while(g<183){d.push({height:g,name:e(g,"height")});g=g+2}d.splice(1,1);d.splice(5,1);d.splice(9,1);return d},getAges:function(){if(f.length>0){return f}var g=17;while(g++<55){f.push({age:g,name:e(g,"age")})}return f},initCarousal:function(){c(function(){$(".carousel").unbind();$(".carousel").carousel("pause").removeData();$(".carousel").on("slide.bs.carousel",function(h){var g=$(h.relatedTarget).find("img");if(!g.attr("src")){g.attr("src",g.data("src"))}});$(".carousel").each(function(){$(this).find(".carousel-inner .item").removeClass("active");var g=$(this).find(".carousel-inner .item:first-child");var h=g.find("img");if(!h.attr("src")){h.attr("src",h.data("src"))}g.addClass("active");$(this).find(".carousel-indicators li").removeClass("active");$(this).find(".carousel-indicators li:first-child").addClass("active");$(this).carousel(0)})})},success:function(g){a.notify={type:"success",msg:[g]};$("#myModal").modal("show")},error:function(g){a.notify={type:"error",msg:[g]};$("#myModal").modal("show")},validation:function(k){var h=[];for(var g in k){var j=k[g].field+"_"+k[g].key;h[g]=appMessages[j]||j}a.notify={type:"error",msg:h};$("#myModal").modal("show")}};return b}]).filter("keyval",function(){return function(b,d){var c=b;for(var a in atrDef[d].vals){if(atrDef[d].vals[a].c==b){return atrDef[d].vals[a].n}}return c}}).filter("ageheight",function(){return function(b,d){var c=b;if(d=="age"){var e=new Date();var g=e.getTime()-b;return Math.floor(g/(1000*60*60*24*365.25))+" years"}if(d="height"){var f=(c*0.393700787).toFixed(0);var a=Math.floor(f/12);f%=12;return a+"' "+f+"''  "}return c}}).config(["$routeProvider",function(a){a.when("/admin-login",{templateUrl:"admin-login.html",controller:"LoginController"}).when("/review-ads",{templateUrl:"admin-review.html",controller:"ReviewAdsController"}).otherwise({redirectTo:"/admin-login"})}]).config(["$httpProvider",function(a){var b=["$q","$location","$rootScope","MatrimonyUtils",function(d,f,c,e){return{request:function(g){c.requestProgress=true;return g||d.when(g)},requestError:function(g){c.requestProgress=false;return d.reject(g)},response:function(g){c.requestProgress=false;var h=g.data.errorCode;if(h){switch(h){case 4400:default:e.validation(g.data.errorResponses);break;case 4401:window.location="admin-996.html";break}return d.reject(g)}return g||d.when(g)},responseError:function(g){c.requestProgress=false;if(g.status===0){e.error("Unable to communicate with server. Please check your network or contact admin.")}else{e.error("Problem occured while processing request. Please try again or contact admin.")}return d.reject(g)}}}];a.interceptors.push(b)}]).controller("ReviewAdsController",["$scope","$http","$timeout","$location","MatrimonyUtils",function(a,f,c,e,b){a.pgSize=10;a.pager=true;a.currPg=0;a.pageSearch=function(g){a.currPg=g;a.search(g)};var d=$(".bootstrap-modal-cropper > img");$("#bootstrap-modal").on("shown.bs.modal",function(i){var g=$(i.relatedTarget);var h=g.data("imgattachid");d.attr("src",hostServer+"/attach/download/"+h);d.cropper({multiple:true,aspectRatio:220/270,zoomable:false,data:{width:220,height:270}}).on({"built.cropper":function(k){var j=d.cropper("getImageData");$("#imageinfo").html("Width: "+j.naturalWidth+" | Height: "+j.naturalHeight)}})}).on("hidden.bs.modal",function(){d.cropper("destroy");a.currentImageData={};a.$apply()}).on("click","[data-method]",function(){var g=$(this).data();if(g.method){d.cropper(g.method,g.option)}});a.allowRemove=true;a.ads={};a.atrDef=atrDef;a.editAd={};a.ages=b.getAges();a.heights=b.getHeights();a.removePic=function(g,h,i){f.post("/admin/remove-pic/"+h.id+"/"+g).success(function(l,j,m,k){$.each(h.attach,function(n,o){if(o.aid==g){h.attach.splice(n,1);b.initCarousal();return false}})})};a.initEdit=function(h,g){a.currentImageData={ad:g,aid:h}};a.approvePic=function(g,h,i){f.post("/admin/approve-pic/"+h.id+"/"+g).success(function(l,j,m,k){$.each(h.attach,function(n,o){if(o.aid==g){h.attach.splice(n,1);b.initCarousal();return false}})})};a.editPic=function(){var h=d.cropper("getData",true);var j=d.cropper("getImageData");if(j.rotate!=0){h.rotate=j.rotate}var g=a.currentImageData.ad;var i=a.currentImageData.aid;f.post("/attach/edit-upload/"+i+"/ad/"+g.id,h).success(function(l){if(l.errorCode){b.validation(l.errorResponses);a.$apply()}else{for(var k in l.success){g.attach.push(l.success[k])}c(function(){b.initCarousal()});b.success("Congratulations! Image successfully uploaded.")}})};a.update=function(g){if(a.adForm.$invalid){b.error("Please fill in all the required fields marked in red to create your profile.");return}f.post("/admin/update/"+g.id,g).success(function(j,h,k,i){b.success("Ad updated successfully.");a.editMode=false})};a.review=function(j,i,h){var g="/admin/review/ad/"+j.id+"/uId/"+j.attr.crBy+"/"+i;if(h){g+="/"+h}f.post(g).success(function(n,k,o,m){a.editMode=false;var l=$.inArray(j,a.ads);a.ads.splice(l,1);b.success("Review completed successfully.")})};a.edit=function(g){a.editMode=true;a.editAd=g;c(function(){$("select").selectpicker("render")})};a.getContact=function(g){if(!g.contact){f.get("/admin/contact/"+g.attr.crBy).success(function(h){g.contact=h.contact;g.activation=h.status})}};a.updateContact=function(h){var g={id:h.attr.crBy,info:h.contact,meta:{setup:h.activation}};f.post("/admin/update-contact/",g).success(function(i){if(i.status){b.success("Contact updated successfully.")}else{b.error("Contact not updated. Please contact DB administrator.")}})};a.lock=function(g){f.get("/admin/lock/"+g.attr.crBy).success(function(h){b.success("Account locked successfully.")})};a.searchByEmail=function(g){f.get("/admin/search/email/"+g+"/").success(function(h){a.pager=false;a.ads=[h];b.initCarousal();c(function(){$("select").selectpicker()})})};a.search=function(g){f.get("/admin/pending-ads/pg/"+g).success(function(j,h,k,i){if(g!=0&&j.length==0){a.currPg--;a.endPg=a.currPg}else{if(g==0&&j.length<a.pgSize){a.pager=false}else{a.pager=true}a.ads=j;b.initCarousal();c(function(){$("select").selectpicker()})}})};a.search(0)}]).controller("LoginController",["$scope","$rootScope","$http","$location",function(b,a,d,c){b.signout=function(){d.post("/signout").success(function(g,e,h,f){c.path("/admin-login")})};b.user={};b.signin=function(e){e.uname=$("#email-box").val();e.pass=$("#pass-box").val();if(!(e.uname&&e.pass)){if(b.loginForm.$invalid){b.showError=true;return}}d.post("/signin",e).success(function(h,f,i,g){a.loggedUser=h.contact;c.path("/review-ads")})}}]);