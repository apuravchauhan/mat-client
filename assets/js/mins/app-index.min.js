var MatrimonialApp=angular.module("MATRIMONIAL-APP",["ngRoute"]),contactEmail="contact@matrified.com",appMessages={"info.mail_notfound":"No account with the given email exists.",pass_invalid:"Please check your password.","info.mail_alreadyexists":"Account with same email already exists.",uId_invalid:"No such email is registered with us. Please try again.",id_invalid:"Your Reset link seems to be expired or already used. Please click on Forget Password to issue a new change request.",account_locked:"Your account has been locked following our usage guidelines. You can submit an unlock appeal to "+contactEmail,error_generic:"Oops! There seems to be a problem processing your request. Please try again or contact us at "+contactEmail};MatrimonialApp.factory("MatrimonyUtils",["$rootScope",function(e){e.hostServer=hostServer;var o={success:function(o){e.notify={type:"success",msg:[o]},$("#myModal").modal("show")},error:function(o){e.notify={type:"error",msg:[o]},$("#myModal").modal("show")},validation:function(o){var t=[];for(var s in o){var r=o[s].field+"_"+o[s].key;t[s]=appMessages[r]||r}e.notify={type:"error",msg:t},$("#myModal").modal("show")}};return o}]).run(["$window","$http",function(e,o){o.get("/signin-status").success(function(o){o.loggedIn&&("undefined"!=typeof Storage&&localStorage.setItem("loggedIn",!0),e.location="home.html")})}]),MatrimonialApp.filter("capitalize",function(){return function(e){return null!=e&&(e=e.toLowerCase()),e.substring(0,1).toUpperCase()+e.substring(1)}}),MatrimonialApp.config(["$httpProvider","$routeProvider",function(e,o){e.defaults.withCredentials=!0,o.when("/",{}).when("/privacy",{templateUrl:"privacy.html"}).when("/contact",{templateUrl:"contact.html"}).when("/terms",{templateUrl:"terms.html"}).when("/initiate-reset/:key",{templateUrl:"reset-key.html",controller:"ResetKeyController"}).otherwise({redirectTo:"/"});var t=["$q","$location","$rootScope","MatrimonyUtils","$window",function(e,o,t,s,r){return{request:function(o){return t.requestProgress=!0,-1==o.url.indexOf(".html")&&(o.url=hostServer+o.url),o||e.when(o)},response:function(o){t.requestProgress=!1,r.scrollTo(0,0);var n=o.data.errorCode;if(n){switch(n){case 4400:default:s.validation(o.data.errorResponses)}return e.reject(o)}return o||e.when(o)},responseError:function(o){return t.requestProgress=!1,s.error(0===o.status?"Network lost or too slow. Try again.":"We are maintaining our servers and will be back shortly. Please try again or contact us at "+contactEmail),e.reject(o)}}}];e.interceptors.push(t)}]),MatrimonialApp.controller("SignupController",["$scope","$http","$window","$timeout","MatrimonyUtils",function(e,o,t,s,r){e.home=!0;var n=window.location.search;n&&(-1!=n.indexOf("activated")?r.success("Account activated! Log in to enjoy full services"):-1!=n.indexOf("interestsent")?r.success("Your interest and contact email successfully shared. Log in to continue"):-1!=n.indexOf("declined")&&r.success("Interest declined! Log in to browse more profiles")),e.user={},e.yearOptions=[],e.dateOptions=[];for(var a=(new Date).getFullYear(),i=0,l=a-18,c=a-80;l-->=c;)e.yearOptions.push(l),++i<=31&&e.dateOptions.push(i);$(".carousel").carousel(),$("#email-box").focus(),$("#cellCode").intlTelInput({autoHideDialCode:!1,dialCodeDelimiter:"",defaultStyling:"outside",preferredCountries:["in","us","gb","ca","nz"]}),e.signup=function(s){if(s.cellCode=$("#cellCode").val(),e.signupForm.$invalid)return void(e.showError=!0);e.showError=!1;var r=new Date(s.meta.bYear,s.meta.bMonth,s.meta.bDay);return r.getDate()!=s.meta.bDay?void(e.invalidDate=!0):(e.invalidDate=!1,s.info.mail=s.info.mail.toLowerCase(),void o.post("/user",s).success(function(){e.success=!0,$("#email-box").val(s.info.mail),$("#pass-box").val(s.pass);var r={uname:s.info.mail,pass:s.pass};o.post("/signin",r).success(function(){"undefined"!=typeof Storage&&localStorage.setItem("loggedIn",!0),t.location="home.html#/postad"})}))}}]),MatrimonialApp.controller("LoginController",["$scope","$http","$window",function(e,o,t){e.user={},e.signin=function(s){return s.uname=$("#email-box").val().toLowerCase(),s.pass=$("#pass-box").val(),s.uname&&s.pass||!e.loginForm.$invalid?void o.post("/signin",s).success(function(e){"undefined"!=typeof Storage&&localStorage.setItem("loggedIn",!0),t.location="ROLE_UNVERIFIED"==e.type?"home.html#/postad":"home.html"}):void(e.showError=!0)}}]).controller("ResetKeyController",["$routeParams","$scope","$http","MatrimonyUtils",function(e,o,t,s){var r=e.key;o.vw="init",1!=r&&(o.vw="change"),o.initiateReset=function(){return o.email=$("#resetEmail").val(),o.resetKeyForm.$invalid?void(o.showError=!0):void t.post("/user/generate-resetkey",{mail:o.email}).success(function(){s.success("Please check your email and click on the reset link.")})},o.resetPass=function(){return o.pass=$("#resetPass").val(),o.resetPassForm.$invalid?void(o.showRError=!0):void t.post("/user/reset",{pass:o.pass,key:r}).success(function(){s.success("Password updated successfully. Please login with your new password now.")})}}]);